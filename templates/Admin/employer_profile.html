<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employer Profile - Admin Dashboard</title>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='Assets/PESO_logo.png') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!--Styles-->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/admin.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/profile.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/loader.css') }}"
    />
  </head>
  <body>
    <!-- Added inline Jinja flash messages with auto-fade -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, msg in messages %}
    <div class="flash {{ 'success' if category=='success' else 'danger' }}">
      {{ msg }}
      <button class="close" onclick="this.parentElement.remove()">×</button>
    </div>
    {% endfor %}
    <script>
      setTimeout(() => {
        const flashes = document.querySelectorAll(".flash");
        flashes.forEach((f) => f.classList.add("fade-out"));
        setTimeout(() => {
          flashes.forEach((f) => f.remove());
        }, 500);
      }, 3000);
    </script>
    {% endif %} {% endwith %}

    <!-- AJAX flash container for dynamic messages -->
    <div id="ajaxFlashContainer"></div>

    <!-- Server-side flash messages (inline) -->

    <!--Header-->
    <header class="header">
      <div class="container">
        <div class="logo">
          <img
            src="{{ url_for('static', filename='Assets/PESO_logo.png') }}"
            alt="PESO SmartHire Logo"
          />
        </div>
        <nav class="nav">
          <a href="{{url_for('admin.admin_home')}}" class="nav-link">Home</a>
          <a
            href="{{ url_for('admin.applicants_management') }}"
            class="nav-link"
            >Applicants</a
          >
          <a
            href="{{ url_for('admin.employers_management') }}"
            class="nav-link-active"
            >Employers</a
          >
          <a href="{{url_for('admin.notifications_page')}}" class="nav-link"
            >Notifications<span
              id="notifBadge"
              class="notif-badge"
              style="display: none"
              >●</span
            ></a
          >
          <a href="{{url_for('admin.account_settings')}}" class="nav-link"
            >Account & Security</a
          >
          <a href="{{url_for('logout')}}" id="logoutLink" class="nav-link"
            >Log Out</a
          >
        </nav>
      </div>
    </header>

    <!--Hero Section-->
    <section class="hero">
      <div class="hero-background">
        <img
          src="{{ url_for('static', filename='Assets/background.png') }}"
          alt="New City Hall of Lipa City"
        />
      </div>
      <div class="hero-content">
        <div class="container">
          <h1 class="hero-title">Employer Profile</h1>
          <p class="hero-description">View employer details and documents</p>
        </div>
      </div>
    </section>

    <!--Back Button and Menu-->
    <section class="account-and-security">
      <div class="container">
        <div class="left">
          <div class="back-button">
            {% if from_notifications %}
            <a href="{{ url_for('admin.notifications_page') }}">
              <i class="fa-solid fa-arrow-left"></i>
            </a>
            {% else %}
            <a href="javascript:history.back()">
              <i class="fa-solid fa-arrow-left"></i>
            </a>
            {% endif %}
          </div>
        </div>
        <div class="right">
          {% if employer.status == 'Approved' %}
          <i class="fa-solid fa-bars" id="menuToggle"></i>
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="#">Suspend Account</a>
            <a href="#">Request to Update Documents</a>
          </div>
          {% endif %}
        </div>
      </div>
    </section>

    <!--Profile Container-->
    <div class="profile-container">
      <!--Header: Logo + Basic Info-->
      <div class="profile-header">
        <div class="profile-pic">
          {% if employer.company_logo_path %}
          <img
            src="{{ url_for('static', filename=employer.company_logo_path) }}"
            alt="Company Logo"
          />
          {% else %}
          <img
            src="{{ url_for('static', filename='Assets/default-company-logo.png') }}"
            alt="Default Company Logo"
          />
          {% endif %}
        </div>
        <div class="profile-details">
          <h2>{{ employer.employer_name }}</h2>
          <p><strong>Industry:</strong> {{ employer.industry }}</p>
          <p>
            <strong>Recruitment Type:</strong> {{ employer.recruitment_type }}
          </p>
        </div>
      </div>

      <!--Contact Information-->
      <div class="section">
        <h3>Contact Information</h3>
        <p><strong>Contact Person:</strong> {{ employer.contact_person }}</p>
        <p><strong>Phone:</strong> {{ employer.phone }}</p>
        <p><strong>Email:</strong> {{ employer.email }}</p>
      </div>

      <!--Address-->
      <div class="section">
        <h3>Address</h3>
        <p><strong>Street:</strong> {{ employer.street }}</p>
        <p><strong>Barangay:</strong> {{ employer.barangay }}</p>
        <p><strong>City:</strong> {{ employer.city }}</p>
        <p><strong>Province:</strong> {{ employer.province }}</p>
      </div>

      <!--Documents-->
      <div class="section documents">
        <h3>Documents</h3>
        <ul>
          {% if employer.company_logo_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.company_logo_path) }}"
              target="_blank"
              >Company Logo</a
            >
          </li>
          {% endif %} {% if employer.business_permit_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.business_permit_path) }}"
              target="_blank"
              >Business Permit</a
            >
          </li>
          {% endif %} {% if employer.philiobnet_registration_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.philiobnet_registration_path) }}"
              target="_blank"
              >PhilJobNet Registration</a
            >
          </li>
          {% endif %} {% if employer.job_orders_of_client_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.job_orders_of_client_path) }}"
              target="_blank"
              >Job Orders of Client</a
            >
          </li>
          {% endif %}
          <!-- Show DOLE documents if they exist, regardless of recruitment_type -->
          {% if employer.dole_no_pending_case_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.dole_no_pending_case_path) }}"
              target="_blank"
              >DOLE No Pending Case</a
            >
          </li>
          {% endif %} {% if employer.dole_authority_to_recruit_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.dole_authority_to_recruit_path) }}"
              target="_blank"
              >DOLE Authority to Recruit</a
            >
          </li>
          {% endif %}
          <!-- Show DMW documents if they exist, regardless of recruitment_type -->
          {% if employer.dmw_no_pending_case_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.dmw_no_pending_case_path) }}"
              target="_blank"
              >DMW No Pending Case</a
            >
          </li>
          {% endif %} {% if employer.license_to_recruit_path %}
          <li>
            <a
              href="{{ url_for('static', filename=employer.license_to_recruit_path) }}"
              target="_blank"
              >License to Recruit</a
            >
          </li>
          {% endif %}
        </ul>
      </div>

      {% if documents %}
      <div class="section document-stats">
        <h3>Document Statistics</h3>
        <div class="document-cards">
          {% for doc in documents %}
          <div class="doc-card">
            <h4>{{ doc.name }}</h4>
            <p>
              <strong>Last Updated:</strong>
              {% if doc.last_updated %} {{ doc.last_updated.strftime('%b %d, %Y
              %I:%M %p') }} {% else %} For Verification {% endif %}
            </p>
            <p>
              <strong>Expires At:</strong>
              {% if doc.expires_at %} {{ doc.expires_at.strftime('%b %d, %Y') }}
              {% else %} Calculating... {% endif %}
            </p>
          </div>

          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!--System Info-->
      <div class="section">
        <h3>System Info</h3>
        <p><strong>Registered At:</strong> {{ employer.created_at }}</p>
        <p><strong>Updated At:</strong> {{ employer.updated_at }}</p>
      </div>

      <!-- Added employer actions section with EDIT STATUS button -->
      {% if employer.status not in ['Approved', 'Rejected', 'Reupload'] %} {% if
      employer.recruitment_type == 'Local' %}
      <div
        class="section"
        data-employer-id="{{ employer.employer_id }}"
        data-recruitment-type="{{ employer.recruitment_type }}"
      >
        <h3>Local Recruitment Employer Actions</h3>
        <p>
          <strong>Contact Person:</strong>
          <span id="employer-contact-person"
            >{{ employer.contact_person }}</span
          >
        </p>
        <p>
          <strong>Status:</strong>
          <span id="employer-status">{{ employer.status }}</span>
        </p>

        <div class="action-buttons">
          <button
            class="edit-status-btn"
            data-employer-id="{{ employer.employer_id }}"
            data-recruitment-type="{{ employer.recruitment_type }}"
          >
            EDIT STATUS
          </button>
        </div>
      </div>
      {% elif employer.recruitment_type == 'International' %}
      <div
        class="section"
        data-employer-id="{{ employer.employer_id }}"
        data-recruitment-type="{{ employer.recruitment_type }}"
      >
        <h3>International Recruitment Employer Actions</h3>
        <p>
          <strong>Contact Person:</strong>
          <span id="employer-contact-person"
            >{{ employer.contact_person }}</span
          >
        </p>
        <p>
          <strong>Status:</strong>
          <span id="employer-status">{{ employer.status }}</span>
        </p>

        <div class="action-buttons">
          <button
            class="edit-status-btn"
            data-employer-id="{{ employer.employer_id }}"
            data-recruitment-type="{{ employer.recruitment_type }}"
            data-change-pending="{{ employer.recruitment_type_change_pending }}"
          >
            EDIT STATUS
          </button>
        </div>
      </div>
      {% endif %} {% endif %}
    </div>

    <!-- Document selection modal used when requesting employer reupload -->
    <div id="documentSelectionModal" class="modal">
      <div class="modal-content">
        <h5>Select Document(s) to Request Re-upload</h5>
        <div style="margin-top: 8px">
          <label
            for="documentCheckboxList"
            style="display: block; margin-bottom: 8px"
            >Choose document(s)</label
          >
          <div id="documentCheckboxList">
            <!-- Checkboxes populated by admin.js -->
          </div>
          <small style="display: block; margin-top: 6px; color: #666"
            >Select one or more documents by checking the boxes.</small
          >
        </div>
        <div style="margin-top: 16px; display: flex; gap: 8px">
          <button id="confirmDocumentBtn" class="status-btn btn-primary">
            Confirm
          </button>
          <button id="cancelDocumentBtn" class="status-btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Loader modal for async operations -->
    {% include 'partials/loader.html' %}

    <div id="statusModal" class="modal">
      <div class="modal-overlay">
        <div class="modal-header">
          <h4>Update Employer Status</h4>
        </div>

        <div class="modal-content-edit-status">
          <button class="status-btn btn-success" data-action="approved">
            <i class="fa-solid fa-check-circle"></i>
            <span>Approve</span>
          </button>

          <button class="status-btn btn-danger" data-action="rejected">
            <i class="fa-solid fa-xmark"></i>
            <span>Reject</span>
          </button>

          <button class="status-btn btn-warning" data-action="reupload">
            <i class="fa-solid fa-upload"></i>
            <span>Request Reupload</span>
          </button>

          <button id="closeModal" class="status-btn btn-secondary">
            <i class="fa-solid fa-ban"></i>
            <span>Cancel</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Rejection reason modal -->
    <div id="rejectionModal" class="modal">
      <div class="modal-content">
        <h5>Provide Rejection Reason</h5>
        <div style="text-align: left; margin-bottom: 12px">
          <label for="rejectionReasonSelect">Reason</label>
          <select id="rejectionReasonSelect">
            <option value="">-- Select a reason --</option>
            <option value="Insufficient documents">
              Insufficient documents
            </option>
            <option value="Invalid details">Invalid details</option>
            <option value="Did not meet requirements">
              Did not meet requirements
            </option>
            <option value="Other">Other (specify)</option>
          </select>
        </div>
        <div style="text-align: left; display: none" id="rejectionOtherWrap">
          <label for="rejectionReasonOther">Other reason</label>
          <textarea id="rejectionReasonOther" rows="3"></textarea>
        </div>
        <div style="margin-top: 16px; display: flex; gap: 8px">
          <button id="confirmRejectionBtn" class="status-btn btn-danger">
            Confirm Reject
          </button>
          <button id="cancelRejectionBtn" class="status-btn btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!--Footer-->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-left">
            <h3>PESO SmartHire</h3>
            <p>
              Connecting talent with opportunity through innovative recruitment
              solutions.
            </p>
            <a href="{{url_for('terms_and_conditions')}}" class="footer-note"
              >Terms and Conditions</a
            >
            <p class="copyright">© 2025 PESO SmartHire. All rights reserved.</p>
          </div>
          <div class="footer-right">
            <h3>Development Team</h3>
            <div class="team-member">
              <span>Anoya, Ruffa F.</span>
              <div class="social-links">
                <a href="https://github.com/anoyaruffa" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a href="#"><i class="devicon-facebook-plain"></i></a>
                <a href="mailto: ruffaanoya2005@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Lavita, Reymark A.</span>
              <div class="social-links">
                <a href="https://github.com/elliwinx" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/reymark.levita.3"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto: levitareymark11@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Samonte, Ralph Matthew A.</span>
              <div class="social-links">
                <a href="https://github.com/RalphWreckeri2" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/ralphmatthew.13"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto:ralphmatthew.samonte@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Global loader partial -->
    {% include 'partials/loader.html' %}
    <!--Scripts-->
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/logout.js') }}"></script>
  </body>
</html>
