<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EMPLOYER - ACCOUNT & SECURITY</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/employer.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/loader.css') }}"
    />
  </head>
  <body>
     <!-- Added flash messages section for success/error notifications -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, msg in messages %}
    <div class="flash {{ 'success' if category=='success' else 'danger' }}">
      {{ msg }}
      <button class="close" onclick="this.parentElement.remove()">×</button>
    </div>
    {% endfor %}
    <script>
      setTimeout(() => {
        const flashes = document.querySelectorAll(".flash");
        flashes.forEach((f) => f.classList.add("fade-out"));
        setTimeout(() => {
          flashes.forEach((f) => f.remove());
        }, 500);
      }, 3000);
    </script>
    {% endif %} {% endwith %}
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="logo">
          <img
            src="{{ url_for('static', filename='Assets/PESO_logo.png') }}"
            alt="PESO SmartHire Logo"
          />
        </div>
        <nav class="nav">
          <a href="{{url_for('employers.employer_home')}}" class="nav-link">Home</a>
          <a href="#" class="nav-link">Application Management</a>
          <a href="#" class="nav-link">Real-Time Notification</a>
          <a href="{{url_for('employers.account_security')}}" class="nav-link-active">Account & Security</a>
          <a href="{{url_for('employers.logout')}}" id="logoutLink" class="nav-link"
            >Log Out</a
          >
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="hero-background">
        <img
          src="{{ url_for('static', filename='Assets/background.png') }}"
          alt="Background"
        />
      </div>
      <div class="hero-content">
        <div class="container">
          <h1 class="hero-title">Welcome{% if session.employer_name %}, {{ session.employer_name }}{% endif %}!</h1>
          <p class="hero-description">Manage your account and security settings</p>
        </div>
      </div>
    </section>

    <section class="account-and-security">
      <div class="container">
        <div class="left">
          <h2>Account & Security</h2>
          <p>Manage your account information and documents.</p>
        </div>
        <div class="right">
          <i class="fa-solid fa-bars" id="menuToggle"></i>
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="#">Deactivate Account</a>
            <a href="{{ url_for('forgot_password.forgot_password', type='employer', next=request.path) }}"
              >Change password</a
            >
          </div>
        </div>
      </div>
    </section>

    <!-- Add data attribute to form container to pass employer status to JavaScript -->
    <div class="container form-card" data-employer-status="{{ employer_status }}">
      <!-- Tab buttons -->
      <div class="button-container" style="display:flex;justify-content:center;gap:10px;margin-bottom:14px;">
        <!-- Show Company Information tab only for Approved status -->
        {% if employer_status == 'Approved' %}
        <button type="button" class="tab-btn active" data-target="company-information">
          Company Information
        </button>
        {% endif %}
        <!-- Show Documents tab, active by default for Reupload status -->
        <button type="button" class="tab-btn {% if employer_status == 'Reupload' %}active{% endif %}" data-target="documents">
          Documents
        </button>
      </div>

      <form id="accountForm"
            method="POST"
            {% if employer_status == 'Reupload' %}
              action="{{ url_for('employers.submit_reupload') }}"
            {% else %}
              action="{{ url_for('employers.account_security') }}"
            {% endif %}
            enctype="multipart/form-data">


        <!-- COMPANY INFORMATION (visible only for Approved status) -->
        <div id="company-information" class="content {% if employer_status != 'Approved' %}hidden{% endif %}">
          <!-- Profile section with company logo - HOVER TO UPLOAD -->
          <div class="profile-top">
            <div class="avatar" style="position: relative; cursor: pointer;">
              <img id="companyLogoPreview" 
                  src="{{ url_for('static', filename=employer.company_logo_path) if employer.company_logo_path else '/placeholder.svg?height=80&width=80' }}" 
                  alt="Company Logo" 
                  style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
              <!-- Hidden file input for company logo - triggered by hover/click -->
              <input type="file" id="company_logo_input" name="company_logo" accept="image/*" 
                    style="position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer;">
            </div>
            <div class="employer-code">{{ employer.employer_code }}</div>
          </div>

          <!-- Company information fields -->
          <div class="three-columns">
            <div class="form-group">
              <label for="employer_name">Company Name</label>
              <input class="chip" type="text" id="employer_name" name="employer_name" value="{{ employer.employer_name }}" readonly />
            </div>
            <div class="form-group">
              <label for="industry">Industry</label>
              <select class="chip" id="industry" name="industry" disabled>
                <!--<option value="">Select Industry</option>-->
                <option value="Technology & IT" {% if employer.industry == 'Technology & IT' %}selected{% endif %}>Technology & IT</option>
                <option value="Finance & Insurance" {% if employer.industry == 'Finance & Insurance' %}selected{% endif %}>Finance & Insurance</option>
                <option value="Healthcare & Pharmaceuticals" {% if employer.industry == 'Healthcare & Pharmaceuticals' %}selected{% endif %}>Healthcare & Pharmaceuticals</option>
                <option value="Education" {% if employer.industry == 'Education' %}selected{% endif %}>Education</option>
                <option value="Manufacturing & Industry" {% if employer.industry == 'Manufacturing & Industry' %}selected{% endif %}>Manufacturing & Industry</option>
                <option value="Retail & E-commerce" {% if employer.industry == 'Retail & E-commerce' %}selected{% endif %}>Retail & E-commerce</option>
                <option value="Media & Entertainment" {% if employer.industry == 'Media & Entertainment' %}selected{% endif %}>Media & Entertainment</option>
                <option value="Real Estate & Construction" {% if employer.industry == 'Real Estate & Construction' %}selected{% endif %}>Real Estate & Construction</option>
                <option value="Transportation & Logistics" {% if employer.industry == 'Transportation & Logistics' %}selected{% endif %}>Transportation & Logistics</option>
                <option value="Energy & Utilities" {% if employer.industry == 'Energy & Utilities' %}selected{% endif %}>Energy & Utilities</option>
                <option value="Government & Nonprofit" {% if employer.industry == 'Government & Nonprofit' %}selected{% endif %}>Government & Nonprofit</option>
                <option value="Professional Services" {% if employer.industry == 'Professional Services' %}selected{% endif %}>Professional Services</option>
                <option value="Hospitality, Food & Travel" {% if employer.industry == 'Hospitality, Food & Travel' %}selected{% endif %}>Hospitality, Food & Travel</option>
              </select>
            </div>
            <div class="form-group">
              <label for="recruitment_type">Type of Recruitment</label>
              <select id="recruitment_type" name="recruitment_type" disabled>
                <!--<option value="">Select Type</option>-->
                <option value="Local" {% if employer.recruitment_type == 'Local' %}selected{% endif %}>Local</option>
                <option value="International" {% if employer.recruitment_type == 'International' %}selected{% endif %}>International</option>
              </select>

              <!-- hidden input to track changes -->
              <input type="hidden" name="recruitment_type_changed" id="recruitment_type_changed" value="false">
            </div>
          </div>

          <div class="three-columns">
            <div class="form-group">
              <label for="contact_person">Contact Person</label>
              <input class="chip" type="text" id="contact_person" name="contact_person" value="{{ employer.contact_person }}" readonly />
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input class="chip" type="tel" id="phone" name="phone" value="{{ employer.phone }}" readonly />
            </div>
            <div class="form-group">
              <label for="email">Email Address</label>
              <input class="chip" type="email" id="email" name="email" value="{{ employer.email }}" readonly />
            </div>
          </div>

          <div class="four-columns">
            <div class="form-group">
              <label for="street">Street</label>
              <input class="chip" type="text" id="street" name="street" value="{{ employer.street }}" readonly />
            </div>
            <div class="form-group">
              <label for="barangay">Barangay</label>
              <input class="chip" type="text" id="barangay" name="barangay" value="{{ employer.barangay }}" readonly />
            </div>
            <div class="form-group">
              <label for="city">Municipality/City</label>
              <input class="chip" type="text" id="city" name="city" value="{{ employer.city }}" readonly />
            </div>
            <div class="form-group">
              <label for="province">Province</label>
              <input class="chip" type="text" id="province" name="province" value="{{ employer.province }}" readonly />
            </div>
          </div>
        </div>

        <!-- DOCUMENTS (clean view - file uploads nested in document items) -->
        <div id="documents" class="content {% if employer_status != 'Reupload' %}hidden{% endif %}">
          <!-- Reupload message for Reupload status -->
          {% if employer_status == 'Reupload' %}
          <div style="background-color:#fff3cd;border:1px solid #ffc107;border-radius:4px;padding:12px;margin-bottom:16px;color:#856404;">
            <strong>Document Reupload Required</strong>
            <p style="margin:8px 0 0 0;font-size:14px;">Please reupload the requested document(s) below. Once submitted, the admin will review your documents and update your status.</p>
          </div>
          {% endif %}

          <div class="documents">
            {% if employer_status == 'Reupload' and documents_to_reupload %}
              <h3 style="margin-bottom:10px;">Please re-upload the following document(s):</h3>

              {% for doc in documents_to_reupload %}
                {# normalize the doc string to match DB prefix like job_orders_of_client #}
                {% set normalized = doc.strip().lower()
                    |replace(' - ', ' ')
                    |replace(' / ', ' ')
                    |replace('  ', ' ')
                    |replace(' ', '_')
                    |replace('-', '_') %}
                {# handle shorter names or known variants (optional map) #}
                {% set alias_map = {
                  'job_orders_of_client': 'job_orders_of_client',
                  'job_orders': 'job_orders_of_client',
                  'business_permit': 'business_permit',
                  'philjobnet_registration': 'philiobnet_registration',
                  'philjobnet_registration': 'philiobnet_registration'
                } %}
                {% if alias_map.get(normalized) %}
                  {% set normalized = alias_map.get(normalized) %}
                {% endif %}
                {% set db_field = normalized + '_path' %}

                <div class="document-item">
                  <div class="document-header">
                    <label>{{ doc.replace('_', ' ')|title }}</label>
                    {% if employer[db_field] %}
                      <a href="{{ url_for('static', filename=employer[db_field]) }}" target="_blank">View</a>
                    {% else %}
                      <span style="color: gray; font-size: 14px;">No existing file</span>
                    {% endif %}
                  </div>
                  <input type="file" name="{{ normalized }}" accept=".pdf" class="file-input" required />
                </div>
              {% endfor %}
            {% else %}
              <!-- LOCAL employers: show DOLE documents -->
              <div class="document-item dole-docs {% if employer.recruitment_type != 'Local' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>Business Permit</label>
                  {% if employer.business_permit_path %}
                  <a href="{{ url_for('static', filename=employer.business_permit_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="business_permit" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dole-docs {% if employer.recruitment_type != 'Local' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>PhilJobNet Registration</label>
                  {% if employer.philiobnet_registration_path %}
                  <a href="{{ url_for('static', filename=employer.philiobnet_registration_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="philiobnet_registration" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dole-docs {% if employer.recruitment_type != 'Local' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>Job Orders of Client</label>
                  {% if employer.job_orders_of_client_path %}
                  <a href="{{ url_for('static', filename=employer.job_orders_of_client_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="job_orders" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dole-docs {% if employer.recruitment_type != 'Local' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>DOLE - No Pending Case Certificate</label>
                  {% if employer.dole_no_pending_case_path %}
                  <a href="{{ url_for('static', filename=employer.dole_no_pending_case_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="dole_no_pending" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dole-docs {% if employer.recruitment_type != 'Local' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>DOLE - Authority to Recruit</label>
                  {% if employer.dole_authority_to_recruit_path %}
                  <a href="{{ url_for('static', filename=employer.dole_authority_to_recruit_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="dole_authority" accept=".pdf" class="file-input" />
              </div>

              <!-- INTERNATIONAL employers: show DMW documents -->
              <div class="document-item dmw-docs {% if employer.recruitment_type != 'International' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>Business Permit</label>
                  {% if employer.business_permit_path %}
                  <a href="{{ url_for('static', filename=employer.business_permit_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="business_permit" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dmw-docs {% if employer.recruitment_type != 'International' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>PhilJobNet Registration</label>
                  {% if employer.philiobnet_registration_path %}
                  <a href="{{ url_for('static', filename=employer.philiobnet_registration_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="philiobnet_registration" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dmw-docs {% if employer.recruitment_type != 'International' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>Job Orders of Client</label>
                  {% if employer.job_orders_of_client_path %}
                  <a href="{{ url_for('static', filename=employer.job_orders_of_client_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="job_orders" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dmw-docs {% if employer.recruitment_type != 'International' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>DMW - No Pending Case Certificate</label>
                  {% if employer.dmw_no_pending_case_path %}
                  <a href="{{ url_for('static', filename=employer.dmw_no_pending_case_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="dmw_no_pending" accept=".pdf" class="file-input" />
              </div>

              <div class="document-item dmw-docs {% if employer.recruitment_type != 'International' %}hidden-doc{% endif %}">
                <div class="document-header">
                  <label>DMW - License to Recruit</label>
                  {% if employer.license_to_recruit_path %}
                  <a href="{{ url_for('static', filename=employer.license_to_recruit_path) }}" target="_blank">View</a>
                  {% endif %}
                </div>
                <input type="file" name="license_to_recruit" accept=".pdf" class="file-input" />
              </div>
            {% endif %}
          </div>

        </div>

      </form>

      <div class="edit-controls" style="margin-top:16px;text-align:right;">
        {% if employer_status == 'Reupload' %}
          <button id="cancelReuploadBtn" type="button" class="cancel-btn" style="margin-right:8px;">Cancel</button>
          <button id="uploadBtn" type="submit" class="save-btn" form="accountForm">Upload Document</button>
        {% else %}
          <button id="cancelBtn" type="button" class="cancel-btn" style="display:none;margin-right:8px;">Cancel</button>
          <button id="editBtn" type="button" class="edit-btn">Edit Profile</button>
          <button id="saveBtn" type="submit" class="save-btn" style="display:none;" form="accountForm">Save</button>
        {% endif %}
      </div>
    </div>

    <!-- Date Info -->
    <div class="date-info">
      <p>Date of Registration: {{ employer.created_at or 'N/A' }}</p>
      {% if employer_status == 'Approved' %}
      <p>Date of Approval: {{ employer.approved_at or 'N/A' }}</p>
      {% endif %}
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-left">
            <h3>PESO SmartHire</h3>
            <p>
              Connecting talent with opportunity through innovative recruitment
              solutions.
            </p>
            <a href="" class="footer-note">Terms and Conditions</a>
            <p class="copyright">© 2025 PESO SmartHire. All rights reserved.</p>
          </div>
          <div class="footer-right">
            <h3>Development Team</h3>
            <div class="team-member">
              <span>Anoya, Ruffa F.</span>
              <div class="social-links">
                <a href="https://github.com/anoyaruffa" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a href="#"><i class="devicon-facebook-plain"></i></a>
                <a href="mailto: ruffaanoya2005@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Levita, Reymark A.</span>
              <div class="social-links">
                <a href="https://github.com/elliwinx" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/reymark.levita.3"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto: levitareymark11@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Samonte, Ralph Matthew A.</span>
              <div class="social-links">
                <a href="https://github.com/RalphWreckeri2" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/ralphmatthew.13"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto:ralphmatthew.samonte@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    {% include 'partials/loader.html' %}
    <script src="{{ url_for('static', filename='js/logout.js') }}"></script>
    <script src="{{ url_for('static', filename='js/employers_account.js') }}"></script>
  </body>
</html>
