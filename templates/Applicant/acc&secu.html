<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account & Security</title>
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='Assets/PESO_logo.png') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/applicant.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/loader.css') }}"
    />
  </head>
  <body>
    <!--Global hidden input-->
    <input type="hidden" id="applicantStatus" value="{{ session.get('applicant_status', '') }}">
    <!--Flash of Message-->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, msg in messages %}
    <div class="flash {{ 'success' if category=='success' else 'danger' }}">
      {{ msg }}
      <button class="close" onclick="this.parentElement.remove()">×</button>
    </div>
    {% endfor %}
    <script>
      setTimeout(() => {
        const flashes = document.querySelectorAll(".flash");
        flashes.forEach((f) => f.classList.add("fade-out"));
        setTimeout(() => {
          flashes.forEach((f) => f.remove());
        }, 500);
      }, 3000);
    </script>
    {% endif %} {% endwith %}
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="logo">
          <img
            src="{{ url_for('static', filename='Assets/PESO_logo.png') }}"
            alt="PESO SmartHire Logo"
          />
        </div>
        <nav class="nav">
          <a href="{{ url_for('applicants.applicant_home') }}" class="nav-link"
            >Home</a
          >
          <a
            href="{{ url_for('applicants.applications_page') }}"
            class="nav-link"
            >Applications</a
          >
          <a href="{{ url_for('applicants.notifications') }}" class="nav-link"
            >Notifications
            <span id="notifBadge" class="notif-badge" style="display: none;">●</span>
          </a>
          <a
            href="{{ url_for('applicants.account_security') }}"
            class="nav-link-active"
            >Account & Security</a
          >
          <a href="{{url_for('logout')}}" id="logoutLink" class="nav-link"
            >Log Out</a
          >
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="hero-background">
        <img
          src="{{ url_for('static', filename='Assets/background.png') }}"
          alt="New City Hall of Lipa CIty"
        />
      </div>
      <div class="hero-content">
        <div class="container">
          <h1 class="hero-title">
            Welcome{% if session.applicant_name %}, {{ session.applicant_name
            }}{% endif %}!
          </h1>
          <!-- You can add the applicant's name here using python-->
          <p class="hero-description">Here's what we have today</p>
        </div>
      </div>
    </section>

    <section class="account-and-security">
      <div class="container">
        <div class="left">
          <h2>Account & Security</h2>
          <p>Manage your account.</p>
        </div>
        <div class="right">
          <i class="fa-solid fa-bars" id="menuToggle"></i>
          <!--Hidden Menu-->
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="#" id="deactivateApplicantBtn">Deactivate Account</a>
            <a href="{{ url_for('forgot_password.forgot_password', type='applicant') }}"
              >Change password</a
            >
          </div>
        </div>
      </div>
    </section>


    <div class="container form-card">
      <!-- Tab buttons -->
      <div class="button-container" style="display:flex;justify-content:center;gap:10px;margin-bottom:14px;">
        <!-- Hide Personal Information tab if status is Reupload -->
        {% if session.get('applicant_status') != 'Reupload' %}
        <button type="button" class="tab-btn active" data-target="personal-information">
          Personal Information
        </button>
        {% endif %}
        <button type="button" class="tab-btn {% if session.get('applicant_status') == 'Reupload' %}active{% endif %}" data-target="documents">
          Documents
        </button>
      </div>

      <form id="accountForm"
        method="POST"
        enctype="multipart/form-data"
        action="{% if applicant.status == 'Reupload' %}
                  {{ url_for('applicants.submit_reupload') }}
                {% else %}
                  {{ url_for('applicants.account_security') }}
                {% endif %}">


        <!-- PERSONAL INFORMATION (default visible, hidden if Reupload) -->
        <div id="personal-information" class="content {% if session.get('applicant_status') == 'Reupload' %}hidden{% endif %}">
          <!-- Profile top -->
          <div class="profile-top">
            <div class="avatar" style="position: relative; cursor: pointer;">
              <img id="profilePicPreview" src="{{ url_for('static', filename=applicant.profile_pic_path) }}" 
                  alt="avatar" 
                  style="width:80px;height:80px;border-radius:8px;object-fit:cover;">
              <input type="file" name="profile_pic" accept="image/*" 
                    style="position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer;">
            </div>
            <div class="applicant-code">{{ applicant.applicant_code }}</div>
          </div>

          <!-- Info grid -->
          <div class="info-grid">
            <!-- First row: names -->
            <div>
              <label>First Name</label>
              <input class="chip" type="text" name="first_name" value="{{ applicant.first_name }}" readonly />
            </div>
            <div>
              <label>Middle Name</label>
              <input class="chip" type="text" name="middle_name" value="{{ applicant.middle_name }}" readonly />
            </div>
            <div>
              <label>Last Name</label>
              <input class="chip" type="text" name="last_name" value="{{ applicant.last_name }}" readonly />
            </div>

            <!-- Age / Sex / Phone / Email -->
            <div class="full">
              <div class="info-row">
                <div class="info-item">
                  <label>Age</label>
                  <input class="chip" type="number" name="age" value="{{ applicant.age }}" readonly />
                </div>

                <div class="info-item">
                  <label>Sex</label>
                  <select class="chip" name="sex" disabled>
                    <option value="Male" {% if applicant.sex == 'Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if applicant.sex == 'Female' %}selected{% endif %}>Female</option>
                  </select>
                </div>

                <div class="info-item">
                  <label>Phone Number</label>
                  <input class="chip" type="text" name="phone" value="{{ applicant.phone }}" readonly />
                </div>

                <div class="info-item">
                  <label>Email Address</label>
                  <input class="chip" type="email" name="email" value="{{ applicant.email }}" readonly />
                </div>
              </div>
            </div>

            <div class="full">
              <label>Are you from Lipa City, Batangas?</label>
              <div class="radio-row">
                <label class="radio-inline">
                  <input type="radio" id="residency_yes" name="is_from_lipa" value="1" {% if applicant.is_from_lipa %}checked{% endif %} disabled />
                  Yes 
                </label>
                <label class="radio-inline">
                  <input type="radio" id="residency_no" name="is_from_lipa" value="0" {% if not applicant.is_from_lipa %}checked{% endif %} disabled />
                  No 
                </label>
              </div>
            </div>

            <!-- Barangay / City / Province -->
            <div>
              <label>Barangay</label>
              <input class="chip" type="text" name="barangay" value="{{ applicant.barangay }}" readonly />
            </div>
            <div>
              <label>Municipality/City</label>
              <input class="chip" type="text" name="city" value="{{ applicant.city }}" readonly />
            </div>
            <div>
              <label>Province</label>
              <input class="chip" type="text" name="province" value="{{ applicant.province }}" readonly />
            </div>

            <!-- Education -->
            <div class="full">
              <label>Educational Attainment</label>
              <input class="chip full" type="text" name="education" value="{{ applicant.education }}" readonly />
            </div>

            <!-- PWD / Work Experience -->
            <div class="full">
              <label>Do you identify as a Person with Disability?</label>
              <div class="radio-row">
                <label class="radio-inline">
                  <input type="radio" id="pwd_yes" name="is_pwd" value="1" {% if applicant.is_pwd %}checked{% endif %} disabled />
                  Yes
                </label>
                <label class="radio-inline">
                  <input type="radio" id="pwd_no" name="is_pwd" value="0" {% if not applicant.is_pwd %}checked{% endif %} disabled />
                  No
                </label>
              </div>

              <!-- conditional: only show when is_pwd == 1 -->
              <div id="pwd_details" class="conditional" style="display:none;margin-top:10px;">
                <label style="font-size:12px;color:#333;margin-bottom:6px;display:block;">If yes, please specify disability type</label>
                <select class="chip select-readonly" name="disability_type">
                  <!--<option value="">Select Disability Type</option>-->
                  <option value="Visual Disability" {% if applicant.pwd_type == 'Visual Disability' %}selected{% endif %}>Visual Disability</option>
                  <option value="Hearing Disability" {% if applicant.pwd_type == 'Hearing Disability' %}selected{% endif %}>Hearing Disability</option>
                  <option value="Speech/Communication Disability" {% if applicant.pwd_type == 'Speech/Communication Disability' %}selected{% endif %}>Speech/Communication Disability</option>
                  <option value="Physical Disability/Orthopedic Disability" {% if applicant.pwd_type == 'Physical Disability/Orthopedic Disability' %}selected{% endif %}>Physical Disability/Orthopedic Disability</option>
                  <option value="Intellectual Disability" {% if applicant.pwd_type == 'Intellectual Disability' %}selected{% endif %}>Intellectual Disability</option>
                  <option value="Learning Disability" {% if applicant.pwd_type == 'Learning Disability' %}selected{% endif %}>Learning Disability</option>
                  <option value="Psychosocial Disability" {% if applicant.pwd_type == 'Psychosocial Disability' %}selected{% endif %}>Psychosocial Disability</option>
                  <option value="Chronic Illness" {% if applicant.pwd_type == 'Chronic Illness' %}selected{% endif %}>Chronic Illness</option>
                  <option value="Multiple Disabilities" {% if applicant.pwd_type == 'Multiple Disabilities' %}selected{% endif %}>Multiple Disabilities</option>
                </select>
              </div>
            </div>

            <div class="full" style="margin-top:8px;">
              <label>Do you have any work experience?</label>
              <div class="radio-row">
                <label class="radio-inline">
                  <input type="radio" id="exp_yes" name="has_work_exp" value="1" {% if applicant.has_work_exp %}checked{% endif %} disabled />
                  Yes
                </label>
                <label class="radio-inline">
                  <input type="radio" id="exp_no" name="has_work_exp" value="0" {% if not applicant.has_work_exp %}checked{% endif %} disabled />
                  No
                </label>
              </div>

              <!-- conditional: only show when has_work_exp == 1 -->
              <div id="work_details" class="conditional" style="display:none;margin-top:10px;">
                <label style="font-size:12px;color:#333;margin-bottom:6px;display:block;">If yes, please specify work experience length</label>
                <select class="chip select-readonly" name="work_duration">
                  <!--<option value="">Select Years of Experience</option>-->
                  <option value="Less than 1" {% if applicant.years_experience == 'Less than 1' %}selected{% endif %}>Less than 1 year</option>
                  <option value="1-2" {% if applicant.years_experience == '1-2' %}selected{% endif %}>1-2 years</option>
                  <option value="3-5" {% if applicant.years_experience == '3-5' %}selected{% endif %}>3-5 years</option>
                  <option value="6-10" {% if applicant.years_experience == '6-10' %}selected{% endif %}>6-10 years</option>
                  <option value="10+" {% if applicant.years_experience == '10+' %}selected{% endif %}>More than 10 years</option>
                </select>
              </div>
            </div>


            <div class="full">
              <label>Reason for Registering in PESO SmartHire</label>
              <textarea class="chip reason-box" name="registration_reason" rows="2" readonly>{{ applicant.registration_reason }}</textarea>
            </div>
          </div>
        </div>

        <!-- ===== DOCUMENTS (city-based residency) ===== -->
        <div id="documents" class="content hidden">
          <!-- Banner hidden by default, shown only on residency change or Reupload status -->
          <div id="residency-warning-banner" 
              class="residency-warning-banner"
              style="display: none;">
            <strong id="banner-title">
              {% if session.get('applicant_status') == 'Reupload' %}
                Document Reupload Required
              {% else %}
                Residency Type Changed
              {% endif %}
            </strong>
            <p style="margin:8px 0 0 0;font-size:14px;" id="banner-message">
              {% if session.get('applicant_status') == 'Reupload' %}
                Please reupload the requested document(s) below. Once submitted, the admin will review your documents and update your status.
              {% else %}
                Your residency type has changed. Please review the document requirements below and upload any necessary documents.
              {% endif %}
            </p>
          </div>

          <div class="documents">
            <!-- Resume (always shown) -->
            <div class="document-item">
              <div class="document-header">
                <label>Resume</label>
                {% if applicant.resume_path %}
                  <a href="{{ url_for('static', filename=applicant.resume_path) }}"
                    target="_blank" rel="noopener">View</a>
                {% endif %}
              </div>
              <input type="file" name="resume_file" id="resume_file"
                    accept=".pdf" class="file-input">
              <!--<small class="file-hint">PDF format only</small>-->
            </div>

            <!-- Recommendation Letter - only shown for Non-Lipeño -->
            <div class="document-item" id="recommendation-upload-container"
                {% if applicant.is_from_lipa %}style="display:none"{% else %}style="display:block"{% endif %}
                data-expiring="{{ 'true' if is_reco_expiring else 'false' }}"> <div class="document-header">
                <label>
                    Recommendation Letter
                    {% if is_reco_expiring %}
                        <span style="color:red; font-size: 0.8em; margin-left: 5px;">(Update Required)</span>
                    {% endif %}
                </label>
                {% if applicant.recommendation_letter_path %}
                  <a href="{{ url_for('static', filename=applicant.recommendation_letter_path) }}"
                    target="_blank" rel="noopener">View</a>
                {% endif %}
              </div>

              <input
                type="file"
                id="recommendation_file"
                name="recommendation_file"
                accept=".pdf"
                class="file-input"
                {% if not applicant.is_from_lipa %}required{% endif %}
              />
            </div>
          </div>
        </div>

        <!-- Edit controls (only in personal info tab) -->
        <!-- Show Upload button for Reupload status, Edit button for Approved status -->
        <div class="edit-controls" style="margin-top:16px;text-align:right;">
          {% if session.get('applicant_status') == 'Reupload' %}
            <!-- Reupload workflow: Upload and Cancel buttons -->
            <button id="cancelReuploadBtn" type="button" class="cancel-btn" style="margin-right:8px;">Cancel</button>
            <button id="uploadBtn" type="submit" class="save-btn">Upload Document</button>
          {% else %}
            <!-- Normal workflow: Edit, Save, Cancel buttons -->
            <button id="cancelBtn" type="button" class="cancel-btn" style="display:none;margin-right:8px;">Cancel</button>
            <button id="editBtn" type="button" class="edit-btn">Edit Profile</button>
            <button id="saveBtn" type="submit" class="save-btn" style="display:none;">Save</button>
          {% endif %}
        </div>

      </form>
    </div>

    <!-- Date Info -->
    <div class="date-info">
      {% if applicant.is_from_lipa %}
        <p>Date of Registration: {{ applicant.created_at or 'N/A' }}</p>
      {% else %}
        <p>Date of Registration: {{ applicant.created_at or 'N/A' }}</p>
        <p>Date of Approval: {{ applicant.approved_at or 'Pending Approval' }}</p>
      {% endif %}
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-left">
            <h3>PESO SmartHire</h3>
            <p>
              Connecting talent with opportunity through innovative recruitment
              solutions.
            </p>
            <a href="{{url_for('terms_and_conditions')}}" class="footer-note">Terms and Conditions</a>
            <p class="copyright">© 2025 PESO SmartHire. All rights reserved.</p>
          </div>
          <div class="footer-right">
            <h3>Development Team</h3>
            <div class="team-member">
              <span>Anoya, Ruffa F.</span>
              <div class="social-links">
                <a href="https://github.com/anoyaruffa" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a href="#"><i class="devicon-facebook-plain"></i></a>
                <a href="mailto: ruffaanoya2005@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Levita, Reymark A.</span>
              <div class="social-links">
                <a href="https://github.com/elliwinx" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/reymark.levita.3"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto: levitareymark11@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
            <div class="team-member">
              <span>Samonte, Ralph Matthew A.</span>
              <div class="social-links">
                <a href="https://github.com/RalphWreckeri2" target="_blank"
                  ><i class="devicon-github-plain"></i
                ></a>
                <a
                  href="https://www.facebook.com/ralphmatthew.13"
                  target="_blank"
                  ><i class="devicon-facebook-plain"></i
                ></a>
                <a href="mailto:ralphmatthew.samonte@gmail.com" target="_blank"
                  ><i class="fa-solid fa-envelope"></i
                ></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Global loader partial -->
    {% include 'partials/loader.html' %}
    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/logout.js') }}"></script>
    <script src="{{ url_for('static', filename='js/applicant.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{{ url_for('static', filename='js/applicant-notification_dot.js') }}"></script>
  </body>
</html>
